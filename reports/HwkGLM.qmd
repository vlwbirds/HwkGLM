---
title: "HwkGLM"
format: html
editor: visual
---

## Model Hawk GLM

This is an attempt to build code for a generalize linear model. The data used are predator-prey reaction behaviors collected by launching a model hawk at birds in the Amazon in Madre de Dios, Peru. Reactions include: no response, call, alarm, sing, dive, hide, freeze, visual search

### Installing Packages

```{r}
#install.packages("glmm")

library(glmm)
library(here)
library(tidyverse)

```

## Loading Hawk Data

```{r}
hwk_GLM <- read_csv(here("data/hwkGLM.csv"))
view(hwk_GLM)

hwk_data <- read_csv(here("data/hwkdata.csv")) %>% 
  mutate(Flock_size = as.numeric(Flock_size)) %>% 
  mutate(Post_Dist = as.numeric(Post_Dist)) %>% 
  mutate(Veg_under_height = as.numeric(Veg_under_height)) %>% 
  mutate(Veg_mid_low = as.numeric(Veg_mid_low)) %>% 
  mutate(Veg_mid_high = as.numeric(Veg_mid_high)) %>% 
  mutate(Veg_can_low = as.numeric(Veg_can_low)) %>% 
  mutate(Veg_can_high = as.numeric(Veg_can_high)) %>% 
  mutate(Rad_Avg_Dense = as.numeric(Rad_Avg_Dense)) %>% 
  mutate(across(c(Species, Mid_Vocal, Mid_Behav_2, Mid_Join, Sex), factor))
         #across(c(Veg_mid_low, Veg_mid_high, Veg_can_low, Veg_can_high, Rad_Avg_Dense), numeric))
  
str(hwk_data)


view(hwk_data)
```

## Generalized Linear Model 1 (larger index)

```{r}
model1 <- glm(Mid_Join_Index1 ~ Mid_Join, data = hwk_GLM, family = poisson(link = "log"))
summary(model1)
```

## Generalized Linear Model 2 (conservative)

```{r}
model2 <- glm(Mid_Join_Index2 ~ Social_Index + SpeciesID + Pre_Height + Pre_Dense, data = hwk_GLM, family = poisson(link = "log"))
summary(model2)
# update to multinomial distrubution
```

response \~ species + veg density + foraging + sociality

Sociality: MSF, singles, pairs, leks, SSF (single species group)

## Model with hwk_data

```{r}

```

## Create Binomial Column for Alarm in Dataframes

```{r}
hwk_GLM$alarm <- ifelse(hwk_GLM$Mid_Join_Index2 == 4,1,0)
View(hwk_GLM)

hwk_data$alarm <- ifelse(hwk_data$Mid_Vocal_Index == 2,1,0)
view(hwk_data)
```

```{r}
model <- glm(alarm ~ Social_Index + SpeciesID + Pre_Height + Pre_Dense, data = hwk_GLM, family = binomial(link = "logit"))
summary(model)
```

```{r}
model <- glm(alarm ~ Social_Index + 
               SpeciesID + 
               Pre_Height + 
               Pre_Dense, 
             data = hwk_GLM, family = binomial(link = "logit"))
summary(model)
```

## Modeling with full hwk_data

```{r}
# selecting only hwk treatment
hwk_subset <- subset(hwk_data, hwk == 1)
hwk_subset$alarm <- ifelse(hwk_subset$Mid_Vocal_Index==2,1,0)
view(hwk_subset)

# GLM model
model <- glm(alarm ~ SppID +
               sexID + 
               Flock_size + 
               Flight_proximity + 
               Pre_Height + 
               Veg_under_height + 
               Veg_mid_low + 
               Veg_mid_high + 
               Rad_Avg_Dense + 
               Pre_Dense, 
             data = hwk_subset, family = binomial(link = "logit"))
summary(model)
```

## Treatment Significance - Control v Hawk

```{r}
trt <- glm(alarm ~ hwk, data = hwk_data, family = binomial(link = "logit"))
summary(trt)             
```
